#!/bin/bash

pidof -o %PPID -x $0 >/dev/null && echo "ERROR: Script $0 already running" && exit 1

[[ $(pgrep -u $UID -x barriers) ]] || barriers -l /tmp/barriers --enable-crypto --config ${HOME}/.local/share/barrier/fiji.conf

tail -f /tmp/barriers | awk '
  /connected/ { system("echo connected > /tmp/barriers-connection") }
  /disconnected/ { system("echo disconnected > /tmp/barriers-connection") }
  /entering/ { system("echo active > /tmp/barriers-screen") }
  /leaving/ { system("echo inactive > /tmp/barriers-screen") }
'
