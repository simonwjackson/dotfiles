#!/bin/bash
# HACK: This will fail on networks outside the home (hard coded IP)

pidof -o %PPID -x $0 >/dev/null && echo "ERROR: Script $0 already running" && exit 1

[[ $(pgrep -u $UID -x barrierc) ]] || barrierc -l /tmp/barrierc --enable-crypto 192.168.1.147

tail -f /tmp/barrierc | awk '
  /connected/ { system("echo connected > /tmp/barrierc-connection") }
  /disconnected/ { system("echo disconnected > /tmp/barrierc-connection") }
  /entering/ { system("echo active > /tmp/barrierc-screen") }
  /leaving/ { system("echo inactive > /tmp/barrierc-screen") }
'
