#!/bin/sh

GIT_HOME=${HOME}/.git

if ! { [ -x "$(command -v git)" ] && [ -x "$(command -v rsync)" ] && [ -x "$(command -v curl)" ] && [ -x "$(command -v openssh)" ]; }; then 
  echo 'Error: Missing dependencies. installing..' >&2
  yay -S --needed --noconfirm git rsync curl openssh
fi 

[[ -z $(git --git-dir ${HOME}/.git status -s) ]] || echo "${HOME} is not clean! exiting.."; exit 1

TMP_DOTFILES=$(mktemp --directory)

git clone https://github.com/simonwjackson/dotfiles.git ${TMP_DOTFILES}

rm -rdf "${GIT_HOME}"
rsync --verbose --archive --recursive ${TMP_DOTFILES}/ ${HOME}

rm -rdf ${TMP_DOTFILES}
